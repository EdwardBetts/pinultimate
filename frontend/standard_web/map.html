<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>Nokia Maps API for JavaScript Example: Add value based heat map</title>
    <script type="text/javascript" charset="UTF-8" src="http://api.maps.nokia.com/2.2.4/jsl.js?with=all"></script>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Tauri' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.1/themes/base/jquery-ui.css">
    <script src="http://code.jquery.com/ui/1.10.1/jquery-ui.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>
    <header>
      <h1 id="pageTitle">Pinultimate</h1>
      <h2 id="pageSubtitle">Bringing Customizable HeatMaps to all Maps</h2>
    </header>
    <div id="sliderContainer">    </div>


    <div id="mapContainer"></div>

    

    <footer>
      <p class="footer-text">Pinultimate in conjunction with Nokia</p>
      <div class="test"></div>
    </footer>

    <script type="text/javascript" src="map.js"></script>
    <script type="text/javascript" src="sampleData.js"></script>
    <script type="text/javascript" src="data.js"></script>
    <script type="text/javascript" src="time_slider.js"></script>
    <script type="text/javascript">


      $(document).ready(function() {

        var centerObject = [37.442,  -122.14];

        // Initialization. radiu is the scale level
        var location = centerObject;
        var radius = 13;



        var data = getNewData(0, location, radius);
        var heatmap_data = JSON.parse(data);
        var heatmap_type = "value"; // or "density"

        var map = createNokiaMap("mapContainer", heatmap_data, heatmap_type, centerObject);
        

        // For drag, i'm not sure to use dragend listner or dragObserver to track the movement. There are some tradeoffs we can discuss tomorrow.

        //Listners
        var dragendHandler = function (evt) {
              //console.log("event "+ evt.type + " @ " + evt.target.$name);
              var center_geo = map.getViewBounds().getCenter();
              console.log(center_geo.latitude);
              console.log(center_geo.longitude);
        };   

        var listeners = {
          //"dragstart": [defaultHandler, false, null],
          //"drag": [defaultHandler, false, null],
          "dragend": [dragendHandler, false, null]

        };
        map.addListeners(listeners);



    // Create a default observer for display properties that will just log a message.
        var dragObserver = function (obj, key, newValue, oldValue) {

            console.log(newValue.longitude);
            console.log(newValue.latitude);

            //set new center
            location = [newValue.latitude, newvalue.longitude];

            //update data
            var newData = getNewData(0, location, radius)
            var heatMap_newData = JSON.parse(newData);
            map.overlays.clear();
            var heatMapOverlay = createHeatMapOverlay(heatMap_newData,heatmap_type);
            map.overlays.add(heatMapOverlay);


            
        };

        var zoomObserver = function (obj, key, newValue, oldValue) {

          //set new radius
          radius = newValue;

          //update data
          var newData = getNewData(0, location, radius)
          var heatMap_newData = JSON.parse(newData);
          map.overlays.clear();
          var heatMapOverlay = createHeatMapOverlay(heatMap_newData,heatmap_type);
          map.overlays.add(heatMapOverlay);

        
        };

        // Template of all map properties we would like to observe
        var observers = {
          "center": dragObserver,
          "zoomLevel": zoomObserver,
        };


// Again we use a simple loop to install all observers at once
for (var mapProperty in observers)
  map.addObserver(mapProperty, observers[mapProperty]);

        
        var changeFunction = function(sliderValue) {


          var newData = getNewData(sliderValue, location, radius)
          var heatMap_newData = JSON.parse(newData);
          map.overlays.clear();
          var heatMapOverlay = createHeatMapOverlay(heatMap_newData,heatmap_type);
          map.overlays.add(heatMapOverlay);
        };


         var slider = createTimeSlider("sliderContainer", changeFunction ,null);
      

      });

      
  
     


      


    </script>
  </body>
</html>
